<!doctype html>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<style>
  body {
    width: 80%;
    max-width: 300px;
    height: 200px;
    margin: auto;
    padding: 50px 10%;
  }
</style>

<body>
  <noscript>
    <a target="_blank" href="https://www.enable-javascript.com/">
      Enable JavaScript
    </a>
    and try again
  </noscript>
  <form method="post" onsubmit="handleLogin(event)">
    <h1 data-register>Create account</h1>
    <h1 data-login>Log in</h1>

    <input name="username" type="text" required placeholder="Username" autocomplete="username">
    <input data-login name="password" type="password" required placeholder="Password" autocomplete="current-password">
    <input data-register name="password" type="password" required placeholder="Password" autocomplete="new-password">
    <input data-register name="email" type="email" placeholder="Email (optional)" autocomplete="email">

    <div data-register><br>You will only be able to reset your password if you provide an e-mail address!
      Otherwise, choose a password you will remember, or store it somewhere safe.
    </div>

    <br>
    <br>

    <label>
      <input name="rememberMe" type="checkbox">
      Remember me
    </label>

    <br>
    <br>

    <input data-login type="submit" formaction="login.lua" value="Log in">
    <input data-register type="submit" formaction="register.lua" value="Register">
  </form>
  <div id="error"></div>

  <!-- <p data-login>
    Forgot password? <button type="button" onclick="forgotPassword()">Send reset e-mail</button>
  </p> -->

  <p data-login>
    New user? <a href="/login.html?signUp">Create an account</a>
  </p>

  <p data-register>
    Already registered? <a href="/login.html">Log in</a>
  </p>

  <script>
    var isRegister = (location.search === '?signUp')
    if (isRegister) {
      Array.from(document.querySelectorAll('[data-login]'))
      .forEach(function (el) { el.remove() })
      document.title = 'Create Account'
    } else {
      Array.from(document.querySelectorAll('[data-register]'))
      .forEach(function (el) { el.remove() })
      document.title = 'Log in'
    }

    var submitButton = document.querySelector('input[type=submit]');
    var errorText = document.querySelector('#error');
  </script>

  <script>
    function handleLogin(e) {
      if (isRegister) {
        if (!e.target.elements.email.value) {
          var proceedWithoutEmail = confirm("Without an e-mail address, you will be unable to reset your password! If you lose your password, you will be unable to recover your data.\n\nContinue?")
          if (!proceedWithoutEmail) {
            event.preventDefault();
            return;
          }
        }
      }
    }

    /*
    function forgotPassword(e) {
      var form = document.querySelector('form')
      var previouslyEntered = form.elements.username.value;
      var username = prompt("Reset password for who?", previouslyEntered)
      if (!username) return;
      userbase.forgotPassword({ username: username })
      .then(function() {
        alert("E-mail sent!")
      })
      .catch(function (err) {
        alert(err.message)
      })
    }
    */
  </script>
</body>